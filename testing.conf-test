<VirtualHost *:80>
    ServerName Testing.test

    # Comment to prevent HTTP to HTTPS redirect
    Redirect permanent / https://Testing.test

    ErrorLog /var/log/apache2/testing-error.log
    CustomLog /var/log/apache2/testing-access.log combined

    RewriteEngine on
    RewriteCond %{SERVER_NAME} =Testing.test
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
    ServerName Testing.test

#     SSLEngine on
#     SSLCertificateFile "/etc/letsencrypt/live/Testing.test/fullchain.pem"
#     SSLCertificateKeyFile "/etc/letsencrypt/live/Testing.test/privkey.pem"
    
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:53/$1" [P,L]

    ProxyRequests On
    ProxyPass / http://localhost:53/
    ProxyPassReverse / http://localhost:53/
</VirtualHost>